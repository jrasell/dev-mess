cpus: 8
memory: "8GiB"

images:
  - location: "https://cloud-images.ubuntu.com/releases/22.04/release/ubuntu-22.04-server-cloudimg-arm64.img"
    arch: "aarch64"
    digest: "sha256:f6b5b3a980f28f25fe5203ae74b79cc664ae5505cf255a62f3b01be46ab9967a"

mounts:
  - location: "~/Projects/Go/nomad"
    mountPoint: "/opt/nomad"
    writable: true

portForwards:
 - guestPort: 4646

networks:
  - lima: shared

provision:
  - mode: user
    script: |
      #!/usr/bin/env bash
      set -eux -o pipefail
      
      sudo apt-get install -y \
        make \
        build-essential \
        unzip

      sudo bash /opt/nomad/scripts/linux-priv-config.sh
      bash /opt/nomad/scripts/linux-priv-go.sh
      sudo bash /opt/nomad/scripts/linux-priv-dev.sh  
      bash /opt/nomad/scripts/linux-priv-docker.sh
      sudo bash /opt/nomad/scripts/linux-priv-cni.sh
      sudo bash /opt/nomad/scripts/linux-priv-consul.sh
